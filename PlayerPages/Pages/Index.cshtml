@page
@using Microsoft.FSharp.Core
@model PlayerPages.Pages.IndexModel
<!DOCTYPE html>
<html class="application">
<head>
    <title>@Model.PageProperties.title</title>
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/material-icons/iconfont/material-icons.css" />
</head>
<body>
    @foreach (var embed in Model.PageProperties.top)
    {
        @await Html.PartialAsync("Embed", embed)
    }
    <details>
        <summary>Menu</summary>
        @foreach (var media in Model.PageProperties.media)
        {
            <a href="@media.src" target="mediaframe">@media.title</a>
        }
        @foreach (var link in Model.PageProperties.links)
        {
            <a href="@link.href" target="_blank">@link.title</a>
        }
        <a href="#" id="debugLink">
            Toggle debug mode
            <br />
            <small>View the page as a document instead of as an application</small>
        </a>
    </details>
    <div id="center-row">
        <div class="embed-column">
            @foreach (var embed in Model.PageProperties.left)
            {
                @await Html.PartialAsync("Embed", embed)
            }
        </div>
        <main>
            <div id="video-parent">
                <!-- JavaScript disabled -->
                <iframe name="mediaframe" src="about:blank"></iframe>
            </div>
            <!-- ko with: controllablePlayer -->
            <div class="controls">
                <button data-bind="click: togglePlay">
                    <!-- ko if: playing -->
                    <span class="material-icons" aria-hidden="true">pause</span>
                    <span class="sr-only">Pause</span>
                    <!-- /ko -->
                    <!-- ko ifnot: playing -->
                    <span class="material-icons" aria-hidden="true">play_arrow</span>
                    <span class="sr-only">Play</span>
                    <!-- /ko -->
                </button>
                <!-- ko if: live -->
                <div class="status line-separator">
                    Live
                </div>
                <!-- /ko -->
                <!-- ko ifnot: live -->
                <button class="adv" data-bind="click: back10">
                    <span class="material-icons" aria-hidden="true">replay_10</span>
                    <span class="sr-only">Back 10 seconds</span>
                </button>
                <button class="adv" data-bind="click: forward10">
                    <span class="material-icons" aria-hidden="true">forward_10</span>
                    <span class="sr-only">Forward 10 seconds</span>
                </button>
                <button class="adv" data-bind="click: back30">
                    <span class="material-icons" aria-hidden="true">replay_30</span>
                    <span class="sr-only">Back 30 seconds</span>
                </button>
                <button class="adv" data-bind="click: forward30">
                    <span class="material-icons" aria-hidden="true">forward_30</span>
                    <span class="sr-only">Forward 30 seconds</span>
                </button>
                <div class="status timestamp line-separator">
                    <span class="sr-only">Timestamp:</span>
                    <span data-bind="text: currentTimeStr">0:00</span>
                </div>
                <input type="range"
                       aria-label="Time"
                       id="seek"
                       data-bind="value: currentTimeMs, attr: { min: 0, max: durationMs }" />
                <div class="status timestamp line-separator">
                    <span class="sr-only">Duration:</span>
                    <span data-bind="text: durationStr">0:00</span>
                </div>
                <!-- /ko -->
                <button data-bind="visible: hasSubtitles, click: toggleSubtitles">
                    <!-- ko ifnot: currentSubtitleTrack() -->
                    <span class="material-icons" aria-hidden="true">subtitles_off</span>
                    <!-- /ko -->
                    <!-- ko if: currentSubtitleTrack() -->
                    <span class="material-icons" aria-hidden="true">subtitles</span>
                    <!-- /ko -->
                    <span class="sr-only">Toggle subtitles</span>
                </button>
                <button>
                    @* This button should request to start Google Cast, which should then trigger the player to switch modes *@
                    @* Should be hidden if not supported in browser *@
                    <span class="material-icons" aria-hidden="true">cast</span>
                    <span class="sr-only">Cast</span>
                </button>
                <button>
                    @* This button should show the Safari/iOS AirPlay dialog *@
                    @* Should be hidden if not supported in browser *@
                    <span class="material-icons" aria-hidden="true">airplay</span>
                    <span class="sr-only">AirPlay</span>
                </button>
                <button data-bind="click: toggleVolumeControls">
                    <span class="material-icons" aria-hidden="true">volume_up</span>
                    <span class="sr-only">Toggle volume controls</span>
                </button>
                <button data-bind="click: toggleFullscreen">
                    <!-- ko if: fullscreen -->
                    <span class="material-icons" aria-hidden="true">fullscreen_exit</span>
                    <span class="sr-only">Exit full screen</span>
                    <!-- /ko -->
                    <!-- ko ifnot: fullscreen -->
                    <span class="material-icons" aria-hidden="true">fullscreen</span>
                    <span class="sr-only">Full screen</span>
                    <!-- /ko -->
                </button>
            </div>
            <div class="controls" data-bind="visible: showVolumeControls">
                <button data-bind="click: toggleMute">
                    <!-- ko if: muted -->
                    <span class="material-icons" aria-hidden="true">volume_off</span>
                    <span class="sr-only">Unmute</span>
                    <!-- /ko -->
                    <!-- ko ifnot: muted -->
                    <span class="material-icons" aria-hidden="true">volume_up</span>
                    <span class="sr-only">Mute</span>
                    <!-- /ko -->
                </button>
                <div class="status line-separator">
                    Volume
                </div>
                <input type="range"
                       id="volume"
                       data-bind="value: vol"
                       min="0"
                       max="1"
                       aria-label="Volume"
                       step="0.1" />
                <div class="line-separator"></div>
                <button>
                    <span class="material-icons" aria-hidden="true">add</span>
                    <span class="sr-only">Volume up</span>
                </button>
                <button>
                    <span class="material-icons" aria-hidden="true">remove</span>
                    <span class="sr-only">Volume down</span>
                </button>
            </div>
            <!-- /ko -->
        </main>
        <div class="embed-column">
            @foreach (var embed in Model.PageProperties.right)
            {
                @await Html.PartialAsync("Embed", embed)
            }
        </div>
    </div>
    <script type="text/javascript" src="~/lib/npo.js"></script>
    <script type="text/javascript" src="~/lib/knockout/build/output/knockout-latest.js"></script>
    <script type="text/javascript" src="~/lib/hls.js/hls.min.js"></script>
    <script type="text/javascript" src="~/js/pps-player.js"></script>
    <script type="text/javascript" src="~/js/hls-player.js"></script>
    <script type="text/javascript" src="~/js/main.js"></script>
</body>
</html>